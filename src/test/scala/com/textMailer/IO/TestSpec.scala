package specs.prepare.IO

import specs.prepare._
import org.scalatra.test.specs2._
import com.textMailer.IO.EmailIO
import com.textMailer.models.Email
import com.textMailer.IO.Eq
import com.textMailer.IO.SendEmail
import scala.concurrent.Future
import scala.concurrent.ExecutionContext.Implicits.global
import scala.actors.Futures

class TestSpec extends MutableScalatraSpec { // specs.prepare.IO.TestSpec
  PrepareData()
  "removing replies from email" should {
    "do something" in {
//      val string = """ <div dir="ltr">Let&#39;s make this happen.. I&#39;ve made a survey. Please submit your votes by <b>Thursday, 11:59pm</b> just in case we wanna do something this weekend.<div><br></div><div>Also, if we happen to do SF this time, let&#39;s do Oakland next time.<br>\r\n<div><br></div><div><a href="https://docs.google.com/forms/d/1hdg1a7XiBunsnb5LKp4XrDtvcy31N-02CJ0DqZ22b2Q/viewform?usp=send_form">https://docs.google.com/forms/d/1hdg1a7XiBunsnb5LKp4XrDtvcy31N-02CJ0DqZ22b2Q/viewform?usp=send_form</a><br>\r\n</div></div></div><div class="gmail_extra"><br><br><div class="gmail_quote">On Mon, Aug 11, 2014 at 11:54 AM, Guy Morita <span dir="ltr">&lt;<a href="mailto:guymorita@gmail.com" target="_blank">guymorita@gmail.com</a>&gt;</span> wrote:<br>\r\n<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">I&#39;m out on the 22nd to Peru, but this weekend could work for brunch.</div><div class="gmail_extra"><div>\r\n<div class="h5"><br><br><div class="gmail_quote">On Sun, Aug 10, 2014 at 9:29 PM, Gregory Hilkert <span dir="ltr">&lt;<a href="mailto:ghilkert@gmail.com" target="_blank">ghilkert@gmail.com</a>&gt;</span> wrote:<br>\r\n<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">I&#39;m in for sure, just let me know when / where<div hspace="streak-pt-mark" style="max-height:1px"><img style="width:0px;max-height:0px" src="https://mailfoogae.appspot.com/t?sender=aZ2hpbGtlcnRAZ21haWwuY29t&amp;type=zerocontent&amp;guid=a488928a-e46d-4818-8cd3-415a975143ff"><font color="#ffffff" size="1">ᐧ</font></div>\r\n\r\n\r\n\r\n</div><div><div><div class="gmail_extra"><br><br><div class="gmail_quote">On Tue, Aug 5, 2014 at 9:35 PM, Barry M. Wong <span dir="ltr">&lt;<a href="mailto:barry@barrymwong.com" target="_blank">barry@barrymwong.com</a>&gt;</span> wrote:<br>\r\n\r\n\r\n\r\n<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr">I&#39;d like to meet up too!</div><div><div><div class="gmail_extra"><br><br>\r\n<div class="gmail_quote">\r\nOn Mon, Aug 4, 2014 at 8:43 PM, Hao Liu <span dir="ltr">&lt;<a href="mailto:haoliu119@gmail.com" target="_blank">haoliu119@gmail.com</a>&gt;</span> wrote:<br>\r\n<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="ltr"><div class="gmail_extra">I&#39;m free after Aug 13th. Whatever Sat/Sun afternoon happy hour in a bar?<div>\r\n\r\n\r\n\r\n\r\n<div><br><br><div class="gmail_quote">On Mon, Aug 4, 2014 at 7:54 PM, Christopher Sita <span dir="ltr">&lt;<a href="mailto:cs.sita@me.com" target="_blank">cs.sita@me.com</a>&gt;</span> wrote:<br>\r\n\r\n<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style="word-wrap:break-word">Brunch and/or drinks within the next two weeks is fine with me. I&#39;m another SF folk willing to travel to Oakland.\xa0<div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n<br></div><div>Looking forward to it.<div><br></div><div>Chris</div><div><div><div>\xa0<div><br></div><div><br><div><div>On Aug 4, 2014, at 6:15 PM, al lin // 林冠祥 &lt;<a href="mailto:lguanxiang@gmail.com" target="_blank">lguanxiang@gmail.com</a>&gt; wrote:</div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n<br><blockquote type="cite"><div dir="ltr">Seconding Sprague&#39;s suggestion of doing it these next two weeks, or sometime in September after Burning Man / Labor Day. The caveat is, if we do it <i>during</i> Burning Man, places won&#39;t be packed at all.<div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<br></div><div>Thanks for taking the initiative, Tuhin! And I&#39;ll be one of the few SF folk willing to head to Oakland, Jake.</div></div><div class="gmail_extra"><br><br><div class="gmail_quote">On Mon, Aug 4, 2014 at 4:54 PM, Gary Ryan <span dir="ltr">&lt;<a href="mailto:gary.thomas.ryan@gmail.com" target="_blank">gary.thomas.ryan@gmail.com</a>&gt;</span> wrote:<br>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir="auto"><div>I&#39;m down! I would be more able to commit to brunch over drinks, but would try to make it to either.<br>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<br>Sent from my iPhone</div><div><div><div><br>On Aug 4, 2014, at 4:14 PM, Tuhin Chakraborty &lt;<a href="mailto:tuhin.c@gmail.com" target="_blank">tuhin.c@gmail.com</a>&gt; wrote:<br><br></div><blockquote type="cite">\r\n<div><div dir="ltr">Hey guys!<div><br></div><div>I miss you all dearly and really want to see your little cherub faces again. To that end, I propose a reunion!!</div><div><br></div><div>Here are some reasons you should come:</div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div><br></div><div>1. You miss Hack Reactor!!!!!!!!!!!!!!</div><div>2. You want to brainstorm million dollar app ideas (and become a millionaire)</div><div>3. You want to make sure you have people to connect you to your next job, whenever you need to find it</div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div>4. You want to eat delicious food / drink with people you don&#39;t normally do that with</div><div>5. You want to keep your Hack Reactor connections fresh (admit it, your office network is small in comparison to the entire industry)</div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div>6. You miss Al&#39;s rageface</div><div>7. You think I&#39;m really good looking</div><div><br></div><div>I&#39;m thinking either Sunday brunch or drinks after work. Can you guys respond to this thread with your preferences / suggestions?<br>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n</div><div><br></div><div>Thanks!</div><div><br></div><div>Peace and love,</div><div><br></div><div>Tuhin<br clear="all"><div><br></div>-- <br><div dir="ltr"><div style="font-family:arial;font-size:small">Tuhin Chakraborty</div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div style="font-family:arial;font-size:small">Duke University, &#39;11</div></div>\r\n</div></div>\r\n</div></blockquote></div></div></div></blockquote></div><br><br clear="all"><div><br></div>-- <br><div dir="ltr">al lin // 林冠祥<div><a href="http://cmdoptesc.com/" target="_blank">cmdoptesc.com</a></div></div>\r\n</div>\r\n</blockquote></div><br></div></div></div></div></div></div></blockquote></div><br></div></div></div></div>\r\n</blockquote></div><br></div>\r\n</div></div></blockquote></div><br></div>\r\n</div></div></blockquote></div><br><br clear="all"><div><br></div></div></div><span class="HOEnZb"><font color="#888888">-- <br><div dir="ltr"><p><font size="1"><a name="147c66c2161a3274_SafeHtmlFilter__MailAutoSig"><b><span style="color:rgb(113,112,115)">Guy Morita</span></b></a><span style="color:rgb(113,112,115)"> </span></font></p>\r\n\r\n\r\n\r\n<p><font size="1"><b><span style="color:rgb(31,73,125)">T</span></b> <span style="color:gray"><span title="Call with Google Voice"><a href="tel:206.240.4846" value="+12062404846" target="_blank">206.240.4846</a></span></span><span style="color:rgb(113,112,115)">\xa0 <b>l</b></span>\xa0\xa0<a href="mailto:guymorita@gmail.com" target="_blank"><b><span style="color:blue">guymorita@gmail.com</span></b></a><b><span style="color:rgb(113,112,115)"></span></b></font></p>\r\n\r\n\r\n\r\n<p><font size="1"><a href="http://www.linkedin.com/in/guymorita" target="_blank"><span style="color:rgb(31,73,125)">LinkedIn</span></a><span style="color:rgb(31,73,125)"> | </span><a href="http://www.guymorita.com/" target="_blank"><span style="color:rgb(31,73,125)">Personal</span></a><span style="color:rgb(31,73,125)"> | <a href="https://github.com/guymorita" target="_blank">Github</a> |\xa0</span><a href="http://guymorita.tumblr.com" target="_blank"><span style="color:rgb(31,73,125)">Developer Blog</span></a><u><span style="color:rgb(31,73,125)"></span></u></font></p>\r\n\r\n\r\n\r\n<p><b><span style="color:rgb(31,73,125)"><font size="1">...............................................................................<br>\r\n...............................................................................<br>\r\n...............................................................................</font></span></b></p></div>\r\n</font></span></div>\r\n</blockquote></div><br><br clear="all"><div><br></div>-- <br><div dir="ltr">al lin // 林冠祥<div><div><a href="http://cmdoptesc.com" target="_blank">cmdoptesc.com</a></div></div></div>\r\n</div>\r\n"""
//      val string1 =  """ <html><head><meta http-equiv="Content-Type" content="text/html charset=windows-1252"></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">I’m having some trouble here and I’m worried we won’t have enough time to cover what you need before my next meeting. What time zone are you in? I can reschedule for later today.<div><br></div><div>Patrick</div><div><br><div><div>On Aug 22, 2014, at 9:32 AM, Patrick McFadin &lt;<a href="mailto:patrick@datastax.com">patrick@datastax.com</a>&gt; wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><meta http-equiv="Content-Type" content="text/html charset=windows-1252"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">Good question. I can send a hangout.<div><br><div><div>On Aug 22, 2014, at 9:21 AM, <a href="mailto:sportano@gmail.com">sportano@gmail.com</a> wrote:</div><br class="Apple-interchange-newline"><blockquote type="cite"><span itemscope="" itemtype="http://schema.org/EmailMessage"><p itemprop="description">Hey guys - are we doing this over phone, or skype / hangout?</p></span><div style=""><table cellspacing="0" cellpadding="8" border="0" summary="" style="width:100%;font-family:Arial,Sans-serif;border:1px Solid #ccc;border-width:1px 2px 2px 1px;background-color:#fff;" itemscope="" itemtype="http://schema.org/Event"><tbody><tr><td><meta itemprop="eventStatus" content="http://schema.org/EventScheduled"><div style="padding:2px"><span itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Google Calendar"></span><meta itemprop="eventId/googleCalendar" content="461ll6trhe11jvs1a4kg4371ug"><h3 style="padding:0 0 6px 0;margin:0;font-family:Arial,Sans-serif;font-size:16px;font-weight:bold;color:#222"><span itemprop="name">Office Hours w/ Stephen Portanova to discuss Meetup presentatio</span></h3><div style="padding-bottom:15px;font-size:13px;color:#222;white-space:pre-wrap!important;white-space:-moz-pre-wrap!important;white-space:-pre-wrap!important;white-space:-o-pre-wrap!important;white-space:pre;word-wrap:break-word">Help Stephen with his first full length talk for a meetup</div><table cellpadding="0" cellspacing="0" border="0" summary="Event details"><tbody><tr><td style="padding:0 1em 10px 0;font-family:Arial,Sans-serif;font-size:13px;color:#888;white-space:nowrap" valign="top"><i style="font-style:normal">When</i></td><td style="padding-bottom:10px;font-family:Arial,Sans-serif;font-size:13px;color:#222" valign="top"><time itemprop="startDate" datetime="20140822T163000Z"></time><time itemprop="endDate" datetime="20140822T170000Z"></time>Fri Aug 22, 2014 9:30am – 10am <span style="color:#888">Pacific Time</span></td></tr><tr><td style="padding:0 1em 10px 0;font-family:Arial,Sans-serif;font-size:13px;color:#888;white-space:nowrap" valign="top"><i style="font-style:normal">Who</i></td><td style="padding-bottom:10px;font-family:Arial,Sans-serif;font-size:13px;color:#222" valign="top"><table cellspacing="0" cellpadding="0"><tbody><tr><td style="padding-right:10px;font-family:Arial,Sans-serif;font-size:13px;color:#222"><span style="font-family:Courier New,monospace">•</span></td><td style="padding-right:10px;font-family:Arial,Sans-serif;font-size:13px;color:#222"><div style="margin:0 0 0.3em 0"><span itemprop="attendee" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Lina Tran</span><meta itemprop="email" content="ltran@datastax.com"></span><span style="font-size:11px;color:#888"> - organizer</span></div></td></tr><tr><td style="padding-right:10px;font-family:Arial,Sans-serif;font-size:13px;color:#222"><span style="font-family:Courier New,monospace">•</span></td><td style="padding-right:10px;font-family:Arial,Sans-serif;font-size:13px;color:#222"><div style="margin:0 0 0.3em 0"><span itemprop="attendee" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Patrick McFadin</span><meta itemprop="email" content="patrick@datastax.com"></span></div></td></tr><tr><td style="padding-right:10px;font-family:Arial,Sans-serif;font-size:13px;color:#222"><span style="font-family:Courier New,monospace">•</span></td><td style="padding-right:10px;font-family:Arial,Sans-serif;font-size:13px;color:#222"><div style="margin:0 0 0.3em 0"><span itemprop="attendee" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Stephen Portanova</span><meta itemprop="email" content="sportano@gmail.com"></span></div></td></tr></tbody></table></td></tr></tbody></table></div></td></tr></tbody></table></div></blockquote></div><br></div></div></blockquote></div><br></div></body></html>"""
      // <div> ???        
//      val newString = string1.split("""<div class="gmail_extra">""").toList.head;
//      println(s"############## stringLength ${newString.length}")
//      println(s"############## string ${newString}")
    }
    
    "futures" in {
      def asyncify[A, B](f: A => B): A => scala.actors.Future[B] = (a => Futures.future(f(a)))
      def sleepFor(seconds: Int) = {
        Thread.sleep(seconds * 1000)
        println(s"######## seconds $seconds")
        seconds
      }
      
      val asyncSleepFor = asyncify(sleepFor)
      val test = asyncSleepFor(5) // now it does NOT block
//      val a = test()
      println("waiting...")         // prints "waiting..." rightaway
//      println("future returns %d".format(test())) // prints "future returns 5" after 5 seconds
    }
  }
  
  "sending emails" should {
    "do something" in {
      val email = Email(123l, "someUserId", 4535335l, "recipients", Some(Set("sportano@gmail.com")), 234243l, "subject", "sender", "cc","bcc","body", "emailBodyHtml")
      SendEmail.send(email, "sportano@gmail.com", "ya29.igB_lAmnGVh0bCz3aUwoDx3T9IqWk65GL_fPklCKNdzxAp36GufbQstx")
    }
  }
}